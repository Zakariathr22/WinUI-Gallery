<?xml version="1.0" encoding="utf-8"?>
<UserControl 
    x:Class="WinUIGallery.Controls.AdaptiveSelectorBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WinUIGallery.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="using:WinUIGallery.Converters"
    mc:Ignorable="d">

    <!-- Resource used to determine button style based on selection -->
    <UserControl.Resources>
        <converters:BoolToAdaptiveSelectorBarItemButtonStyleConverter x:Key="BoolToAdaptiveSelectorBarItemButtonStyleConverter" />
    </UserControl.Resources>

    <Grid>
        <!-- Hidden panel used for pre-measuring item sizes to handle overflow -->
        <StackPanel x:Name="MeasurementPanel"
                    Spacing="8"
                    Orientation="Horizontal"
                    Visibility="Collapsed" />

        <!-- Main layout container for visible items and the overflow "More" button -->
        <StackPanel x:Name="RootPanel"
                    Orientation="Horizontal">

            <!-- Displays visible items only -->
            <ItemsControl x:Name="VisibleItemsControl"
                          ItemsSource="{x:Bind _visibleItems}"
                          Margin="0,0,8,0">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="local:AdaptiveSelectorBarItem">
                        <!-- Button for each item, bound to item properties -->
                        <Button Click="OnItemClicked"
                                Tag="{x:Bind}"
                                Margin="0,5"
                                Style="{Binding IsSelected, Converter={StaticResource BoolToAdaptiveSelectorBarItemButtonStyleConverter}}">
                            <Grid ColumnSpacing="8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="auto" />
                                    <ColumnDefinition Width="auto" />
                                </Grid.ColumnDefinitions>
                                <!-- Icon and label -->
                                <FontIcon FontSize="16"
                                          Glyph="{x:Bind FontIconGlyph}" />
                                <TextBlock Grid.Column="1"
                                           Text="{x:Bind DisplayText}" />
                            </Grid>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <!-- Horizontal layout for visible items -->
                        <StackPanel Orientation="Horizontal"
                                    Spacing="8" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>

            <!-- Overflow button that opens a flyout with hidden items -->
            <Button x:Name="MoreButton"
                    Click="OnMoreClicked"
                    Visibility="Collapsed"
                    Style="{StaticResource CommandBarFlyoutEllipsisButtonStyle}">
                <FontIcon Glyph="&#xE712;" />
                <Button.Flyout>
                    <MenuFlyout x:Name="OverflowFlyout" />
                </Button.Flyout>
                <ToolTipService.ToolTip>
                    <x:String>More</x:String>
                </ToolTipService.ToolTip>
            </Button>
        </StackPanel>
    </Grid>
</UserControl>